<!doctype html>
<html lang="si">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>PASIYA-MD — WhatsApp Session Generator</title>
  <style>
    :root{--bg:#0b0f1a;--card:#0f1724;--accent:#7c3aed}
    body{margin:0;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#030417 0%,#07102a 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:980px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(2,6,23,0.7)}
    header{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:#c9d5eecc}
    .grid{display:grid;grid-template-columns:320px 1fr;gap:16px;margin-top:18px}
    .card{background:var(--card);padding:14px;border-radius:12px;min-height:220px}
    .qr{width:100%;height:320px;background:#061025;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    img.qrimg{max-width:100%;max-height:100%}
    .meta{display:flex;flex-direction:column;gap:8px}
    .btn{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:white;cursor:pointer}
    .muted{color:#9fb0d6}
    .textarea{background:#081228;border:1px solid rgba(255,255,255,0.03);padding:10px;border-radius:8px;font-family:monospace;color:#dff;white-space:pre-wrap;max-height:300px;overflow:auto}
    footer{margin-top:14px;color:#9fb0d6;font-size:13px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="logo">PM</div>
      <div>
        <h1>PASIYA-MD — WhatsApp Session Generator</h1>
        <p class="lead">QR & Pair code viewer for your bot. Backend must be running and connected to WhatsApp.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <div style="display:flex;flex-direction:column;height:100%">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <strong>QR / Pair</strong>
            <div class="muted">Bot: <strong>PASIYA-MD</strong></div>
          </div>
          <div class="qr" id="qrwrap">
            <div class="muted" id="qrplaceholder">Waiting for QR from backend...</div>
          </div>
          <div style="margin-top:10px;display:flex;gap:8px">
            <button class="btn" id="copySessionBtn">Copy Session</button>
            <button class="btn" id="refreshBtn">Refresh</button>
            <div style="flex:1"></div>
            <div class="muted">Status: <span id="statusText">disconnected</span></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="meta">
          <div><strong>Session / Pair data</strong></div>
          <div class="textarea" id="sessionData">No session data yet.</div>
          <div class="muted">Pair code is usually a short string shown once during pairing. Session ID may look like a JSON object or a key blob (base64).</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button class="btn" id="downloadBtn">Download Session JSON</button>
            <button class="btn" id="clearBtn">Clear</button>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div>Notes: Backend must run a WhatsApp Web client (e.g., Baileys) and send QR as base64 image and session data via WebSocket or HTTP SSE.</div>
    </footer>
  </div>

<script>
  const statusText = document.getElementById('statusText');
  const qrwrap = document.getElementById('qrwrap');
  const qrplaceholder = document.getElementById('qrplaceholder');
  const sessionDataEl = document.getElementById('sessionData');

  let ws;
  function connect(){
    statusText.textContent = 'connecting...';
    const protocol = location.protocol === 'https:' ? 'wss' : 'ws';
    const wsUrl = protocol + '://' + location.hostname + (location.port ? ':'+location.port : '') + '/ws';
    ws = new WebSocket(wsUrl);

    ws.onopen = ()=>{ statusText.textContent = 'connected'; }
    ws.onclose = ()=>{ statusText.textContent = 'disconnected'; setTimeout(connect,2000); }
    ws.onerror = (e)=>{ console.error(e); }

    ws.onmessage = (ev)=>{
      try{
        const msg = JSON.parse(ev.data);
        if(msg.type === 'qr'){
          qrplaceholder.style.display = 'none';
          let img = document.querySelector('img.qrimg');
          if(!img){ img = document.createElement('img'); img.className='qrimg'; qrwrap.appendChild(img); }
          img.src = msg.data;
        } else if(msg.type === 'session'){
          sessionDataEl.textContent = JSON.stringify(msg.data, null, 2);
        } else if(msg.type === 'pair'){
          sessionDataEl.textContent = 'Pair code: ' + msg.data + '\n\n' + sessionDataEl.textContent;
        } else if(msg.type === 'status'){
          statusText.textContent = msg.data;
        }
      }catch(err){ console.error('invalid msg', err); }
    }
  }
  connect();

  document.getElementById('copySessionBtn').onclick = ()=>{
    navigator.clipboard.writeText(sessionDataEl.textContent || '').then(()=>alert('Copied'));
  }
  document.getElementById('refreshBtn').onclick = ()=>{ ws && ws.send(JSON.stringify({ action:'refreshQR' })); }
  document.getElementById('downloadBtn').onclick = ()=>{
    const blob = new Blob([sessionDataEl.textContent || ''], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download='session.json'; a.click(); URL.revokeObjectURL(url);
  }
  document.getElementById('clearBtn').onclick = ()=>{ sessionDataEl.textContent=''; const img = document.querySelector('img.qrimg'); if(img) img.remove(); qrplaceholder.style.display='block'; }
</script>
</body>
</html>
